"use client";

import { useState, useEffect } from "react";
import { 
  Card, 
  CardContent, 
  CardDescription, 
  CardHeader, 
  CardTitle 
} from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { 
  Table, 
  TableBody, 
  TableCell, 
  TableHead, 
  TableHeader, 
  TableRow 
} from "@/components/ui/table";
import { Plus, TrendingUp, TrendingDown } from "lucide-react";

interface Campaign {
  id: string;
  name: string;
  investment: number;
  return: number;
  clicks: number;
  dailyProfit: number;
  weeklyProfit: number;
  monthlyProfit: number;
  roi: number;
  costPerLead: number;
}

export default function CampaignDashboard() {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [newCampaign, setNewCampaign] = useState({
    name: "",
    investment: "",
    return: "",
    clicks: ""
  });
  const [errors, setErrors] = useState<Record<string, string>>({});

  // Load campaigns from localStorage on initial render
  useEffect(() => {
    const savedCampaigns = localStorage.getItem("campaigns");
    if (savedCampaigns) {
      setCampaigns(JSON.parse(savedCampaigns));
    }
  }, []);

  // Save campaigns to localStorage whenever they change
  useEffect(() => {
    localStorage.setItem("campaigns", JSON.stringify(campaigns));
  }, [campaigns]);

  const validateForm = () => {
    const newErrors: Record<string, string> = {};
    
    if (!newCampaign.name.trim()) {
      newErrors.name = "Campaign name is required";
    }
    
    if (!newCampaign.investment || parseFloat(newCampaign.investment) <= 0) {
      newErrors.investment = "Investment must be a positive number";
    }
    
    if (!newCampaign.return || parseFloat(newCampaign.return) < 0) {
      newErrors.return = "Return must be a valid number";
    }
    
    if (!newCampaign.clicks || parseInt(newCampaign.clicks) <= 0) {
      newErrors.clicks = "Clicks must be a positive number";
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setNewCampaign({
      ...newCampaign,
      [name]: value
    });
    
    // Clear error when user starts typing
    if (errors[name]) {
      setErrors({
        ...errors,
        [name]: ""
      });
    }
  };

  const addCampaign = () => {
    if (!validateForm()) return;
    
    const investment = parseFloat(newCampaign.investment);
    const returnAmount = parseFloat(newCampaign.return);
    const clicks = parseInt(newCampaign.clicks);
    
    const dailyProfit = returnAmount - investment;
    const roi = investment > 0 ? (dailyProfit / investment) * 100 : 0;
    const costPerLead = clicks > 0 ? investment / clicks : 0;
    
    const campaign: Campaign = {
      id: Date.now().toString(),
      name: newCampaign.name,
      investment,
      return: returnAmount,
      clicks,
      dailyProfit,
      weeklyProfit: dailyProfit * 7,
      monthlyProfit: dailyProfit * 30,
      roi,
      costPerLead
    };
    
    setCampaigns([...campaigns, campaign]);
    
    // Reset form
    setNewCampaign({
      name: "",
      investment: "",
      return: "",
      clicks: ""
    });
  };

  const sortedCampaigns = [...campaigns].sort((a, b) => b.dailyProfit - a.dailyProfit);
  const topCampaigns = sortedCampaigns.slice(0, 5);

  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 2
    }).format(value);
  };

  const formatPercentage = (value: number) => {
    return `${value.toFixed(2)}%`;
  };

  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-8">
      <div className="mx-auto max-w-7xl">
        <header className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900">Campaign Performance Dashboard</h1>
          <p className="text-gray-600">Track and analyze your marketing campaign profitability</p>
        </header>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Left Column - Form */}
          <div className="lg:col-span-1">
            <Card>
              <CardHeader>
                <CardTitle>Add New Campaign</CardTitle>
                <CardDescription>Enter campaign metrics to calculate performance</CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="space-y-2">
                  <label htmlFor="name" className="text-sm font-medium">Campaign Name</label>
                  <Input
                    id="name"
                    name="name"
                    value={newCampaign.name}
                    onChange={handleInputChange}
                    placeholder="Summer Sale 2023"
                    className={errors.name ? "border-red-500" : ""}
                  />
                  {errors.name && <p className="text-red-500 text-sm">{errors.name}</p>}
                </div>
                
                <div className="space-y-2">
                  <label htmlFor="investment" className="text-sm font-medium">Investment ($)</label>
                  <Input
                    id="investment"
                    name="investment"
                    type="number"
                    value={newCampaign.investment}
                    onChange={handleInputChange}
                    placeholder="1000"
                    className={errors.investment ? "border-red-500" : ""}
                  />
                  {errors.investment && <p className="text-red-500 text-sm">{errors.investment}</p>}
                </div>
                
                <div className="space-y-2">
                  <label htmlFor="return" className="text-sm font-medium">Return ($)</label>
                  <Input
                    id="return"
                    name="return"
                    type="number"
                    value={newCampaign.return}
                    onChange={handleInputChange}
                    placeholder="2500"
                    className={errors.return ? "border-red-500" : ""}
                  />
                  {errors.return && <p className="text-red-500 text-sm">{errors.return}</p>}
                </div>
                
                <div className="space-y-2">
                  <label htmlFor="clicks" className="text-sm font-medium">Clicks</label>
                  <Input
                    id="clicks"
                    name="clicks"
                    type="number"
                    value={newCampaign.clicks}
                    onChange={handleInputChange}
                    placeholder="5000"
                    className={errors.clicks ? "border-red-500" : ""}
                  />
                  {errors.clicks && <p className="text-red-500 text-sm">{errors.clicks}</p>}
                </div>
                
                <Button onClick={addCampaign} className="w-full mt-4">
                  <Plus className="mr-2 h-4 w-4" /> Add Campaign
                </Button>
              </CardContent>
            </Card>
          </div>

          {/* Right Column - Metrics and Rankings */}
          <div className="lg:col-span-2 space-y-6">
            {/* Performance Metrics */}
            <Card>
              <CardHeader>
                <CardTitle>Performance Metrics</CardTitle>
                <CardDescription>Key profitability indicators for all campaigns</CardDescription>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h3 className="text-sm font-medium text-blue-800">Total Investment</h3>
                    <p className="text-2xl font-bold text-blue-600">
                      {formatCurrency(campaigns.reduce((sum, c) => sum + c.investment, 0))}
                    </p>
                  </div>
                  
                  <div className="bg-green-50 p-4 rounded-lg">
                    <h3 className="text-sm font-medium text-green-800">Total Return</h3>
                    <p className="text-2xl font-bold text-green-600">
                      {formatCurrency(campaigns.reduce((sum, c) => sum + c.return, 0))}
                    </p>
                  </div>
                  
                  <div className="bg-purple-50 p-4 rounded-lg">
                    <h3 className="text-sm font-medium text-purple-800">Total Profit</h3>
                    <p className="text-2xl font-bold text-purple-600">
                      {formatCurrency(campaigns.reduce((sum, c) => sum + c.dailyProfit, 0))}
                    </p>
                  </div>
                  
                  <div className="bg-amber-50 p-4 rounded-lg">
                    <h3 className="text-sm font-medium text-amber-800">Avg. ROI</h3>
                    <p className="text-2xl font-bold text-amber-600">
                      {campaigns.length > 0 
                        ? formatPercentage(campaigns.reduce((sum, c) => sum + c.roi, 0) / campaigns.length) 
                        : "0.00%"}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Campaign Rankings */}
            <Card>
              <CardHeader>
                <CardTitle>Top Performing Campaigns</CardTitle>
                <CardDescription>Ranked by daily profit (highest first)</CardDescription>
              </CardHeader>
              <CardContent>
                {topCampaigns.length > 0 ? (
                  <Table>
                    <TableHeader>
                      <TableRow>
                        <TableHead>Rank</TableHead>
                        <TableHead>Campaign</TableHead>
                        <TableHead className="text-right">Daily Profit</TableHead>
                        <TableHead className="text-right">ROI</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {topCampaigns.map((campaign, index) => (
                        <TableRow key={campaign.id}>
                          <TableCell>
                            <Badge 
                              variant={index === 0 ? "default" : "secondary"}
                              className={index === 0 ? "bg-yellow-500" : ""}
                            >
                              {index + 1}
                            </Badge>
                          </TableCell>
                          <TableCell className="font-medium">{campaign.name}</TableCell>
                          <TableCell className="text-right">
                            <span className={campaign.dailyProfit >= 0 ? "text-green-600" : "text-red-600"}>
                              {formatCurrency(campaign.dailyProfit)}
                            </span>
                          </TableCell>
                          <TableCell className="text-right">
                            <span className={campaign.roi >= 0 ? "text-green-600" : "text-red-600"}>
                              {formatPercentage(campaign.roi)}
                            </span>
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    <TrendingUp className="mx-auto h-12 w-12 opacity-50" />
                    <p className="mt-2">No campaigns added yet</p>
                    <p className="text-sm">Add your first campaign to see rankings</p>
                  </div>
                )}
              </CardContent>
            </Card>

            {/* Detailed Campaign List */}
            <Card>
              <CardHeader>
                <CardTitle>All Campaigns</CardTitle>
                <CardDescription>Detailed performance metrics</CardDescription>
              </CardHeader>
              <CardContent>
                {campaigns.length > 0 ? (
                  <div className="overflow-x-auto">
                    <Table>
                      <TableHeader>
                        <TableRow>
                          <TableHead>Campaign</TableHead>
                          <TableHead className="text-right">Investment</TableHead>
                          <TableHead className="text-right">Return</TableHead>
                          <TableHead className="text-right">Daily Profit</TableHead>
                          <TableHead className="text-right">Weekly</TableHead>
                          <TableHead className="text-right">Monthly</TableHead>
                          <TableHead className="text-right">ROI</TableHead>
                          <TableHead className="text-right">CPL</TableHead>
                        </TableRow>
                      </TableHeader>
                      <TableBody>
                        {campaigns.map((campaign) => (
                          <TableRow key={campaign.id}>
                            <TableCell className="font-medium">{campaign.name}</TableCell>
                            <TableCell className="text-right">{formatCurrency(campaign.investment)}</TableCell>
                            <TableCell className="text-right">{formatCurrency(campaign.return)}</TableCell>
                            <TableCell className="text-right">
                              <span className={campaign.dailyProfit >= 0 ? "text-green-600" : "text-red-600"}>
                                {formatCurrency(campaign.dailyProfit)}
                              </span>
                            </TableCell>
                            <TableCell className="text-right">
                              <span className={campaign.weeklyProfit >= 0 ? "text-green-600" : "text-red-600"}>
                                {formatCurrency(campaign.weeklyProfit)}
                              </span>
                            </TableCell>
                            <TableCell className="text-right">
                              <span className={campaign.monthlyProfit >= 0 ? "text-green-600" : "text-red-600"}>
                                {formatCurrency(campaign.monthlyProfit)}
                              </span>
                            </TableCell>
                            <TableCell className="text-right">
                              <span className={campaign.roi >= 0 ? "text-green-600" : "text-red-600"}>
                                {formatPercentage(campaign.roi)}
                              </span>
                            </TableCell>
                            <TableCell className="text-right">{formatCurrency(campaign.costPerLead)}</TableCell>
                          </TableRow>
                        ))}
                      </TableBody>
                    </Table>
                  </div>
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    <TrendingDown className="mx-auto h-12 w-12 opacity-50" />
                    <p className="mt-2">No campaigns in the system</p>
                    <p className="text-sm">Add campaigns using the form to see detailed metrics</p>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
}

Compartilhar

Atualizar

CÃ³pia

