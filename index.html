<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Avançado de Campanhas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            success: '#10b981',
            danger: '#ef4444',
            warning: '#f59e0b',
            info: '#0ea5e9'
          }
        }
      }
    }
  </script>
  <style>
    .card {
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }
    
    .metric-card {
      transition: all 0.2s ease;
    }
    
    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
    }
    
    .profit-positive {
      color: #10b981;
    }
    
    .profit-negative {
      color: #ef4444;
    }
    
    .rank-1 {
      background-color: #fbbf24;
      color: #78350f;
    }
    
    .rank-other {
      background-color: #e5e7eb;
      color: #374151;
    }
    
    .form-input {
      display: block;
      width: 100%;
      border-radius: 0.375rem;
      border: 1px solid #d1d5db;
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
      line-height: 1.5rem;
    }
    
    .form-input:focus {
      outline: 2px solid transparent;
      outline-offset: 2px;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.375rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      line-height: 1.5rem;
      transition: all 0.15s ease;
    }
    
    .btn-primary {
      background-color: #3b82f6;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #2563eb;
    }
    
    .btn-secondary {
      background-color: #f3f4f6;
      color: #374151;
      border: 1px solid #d1d5db;
    }
    
    .btn-secondary:hover {
      background-color: #e5e7eb;
    }
    
    .error {
      color: #ef4444;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th {
      background-color: #f9fafb;
      text-align: left;
      font-weight: 600;
      color: #6b7280;
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    td {
      padding: 0.75rem 1rem;
      border-top: 1px solid #e5e7eb;
      color: #374151;
    }
    
    tr:hover td {
      background-color: #f9fafb;
    }
    
    .period-selector {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .period-btn {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      border-radius: 0.375rem;
      background-color: #f3f4f6;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    
    .period-btn.active {
      background-color: #3b82f6;
      color: white;
    }
    
    .campaign-selector {
      margin-bottom: 1rem;
    }
    
    .campaign-selector select {
      width: 100%;
      padding: 0.5rem;
      border-radius: 0.375rem;
      border: 1px solid #d1d5db;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
  <div class="max-w-7xl mx-auto">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Dashboard Avançado de Campanhas</h1>
      <p class="text-gray-600">Acompanhe e analise a rentabilidade das suas campanhas por período</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Formulário -->
      <div class="lg:col-span-1">
        <div class="card p-6">
          <div class="mb-5">
            <h2 class="text-xl font-bold text-gray-900">Adicionar Nova Campanha</h2>
            <p class="text-gray-600">Insira os dados da campanha para calcular a performance</p>
          </div>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Campanha</label>
              <input 
                type="text" 
                id="campaignName" 
                class="form-input" 
                placeholder="Venda de Verão 2023"
              >
              <div id="nameError" class="error hidden"></div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Investimento (R$)</label>
              <input 
                type="number" 
                id="investment" 
                class="form-input" 
                placeholder="1000"
                min="0" 
                step="0.01"
              >
              <div id="investmentError" class="error hidden"></div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Retorno (R$)</label>
              <input 
                type="number" 
                id="return" 
                class="form-input" 
                placeholder="2500"
                min="0" 
                step="0.01"
              >
              <div id="returnError" class="error hidden"></div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Cliques</label>
              <input 
                type="number" 
                id="clicks" 
                class="form-input" 
                placeholder="5000"
                min="1"
              >
              <div id="clicksError" class="error hidden"></div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Período</label>
              <select id="period" class="form-input">
                <option value="daily">Diário</option>
                <option value="weekly">Semanal</option>
                <option value="monthly">Mensal</option>
                <option value="yearly">Anual</option>
              </select>
            </div>
            
            <button id="addCampaignBtn" class="btn btn-primary w-full mt-4">
              <i class="fas fa-plus mr-2"></i> Adicionar Campanha
            </button>
          </div>
        </div>
      </div>

      <!-- Métricas e Rankings -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Seletores -->
        <div class="card p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="campaign-selector">
              <label class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Campanha</label>
              <select id="campaignFilter" class="form-input">
                <option value="all">Todas as Campanhas</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Período de Visualização</label>
              <div class="period-selector">
                <div class="period-btn active" data-period="daily">Diário</div>
                <div class="period-btn" data-period="weekly">Semanal</div>
                <div class="period-btn" data-period="monthly">Mensal</div>
                <div class="period-btn" data-period="yearly">Anual</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Métricas de Performance -->
        <div class="card">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-900">Métricas de Performance</h2>
            <p class="text-gray-600">Indicadores principais de rentabilidade por período</p>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <div class="metric-card bg-blue-50 p-4 rounded-lg">
                <h3 class="text-sm font-medium text-blue-800">Investimento Total</h3>
                <p id="totalInvestment" class="text-2xl font-bold text-blue-600">R$ 0,00</p>
              </div>
              
              <div class="metric-card bg-green-50 p-4 rounded-lg">
                <h3 class="text-sm font-medium text-green-800">Retorno Total</h3>
                <p id="totalReturn" class="text-2xl font-bold text-green-600">R$ 0,00</p>
              </div>
              
              <div class="metric-card bg-purple-50 p-4 rounded-lg">
                <h3 class="text-sm font-medium text-purple-800">Lucro Total</h3>
                <p id="totalProfit" class="text-2xl font-bold text-purple-600">R$ 0,00</p>
              </div>
              
              <div class="metric-card bg-amber-50 p-4 rounded-lg">
                <h3 class="text-sm font-medium text-amber-800">ROI Médio</h3>
                <p id="avgRoi" class="text-2xl font-bold text-amber-600">0,00%</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Rankings -->
        <div class="card">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-900">Campanhas Mais Rentáveis</h2>
            <p class="text-gray-600">Classificadas pelo lucro (maiores primeiro)</p>
          </div>
          <div class="p-6">
            <div id="rankingsContainer">
              <div class="text-center py-8 text-gray-500">
                <i class="fas fa-chart-line text-5xl mb-4 opacity-50"></i>
                <p class="mt-2">Nenhuma campanha adicionada ainda</p>
                <p class="text-sm">Adicione sua primeira campanha para ver os rankings</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista Detalhada -->
        <div class="card">
          <div class="p-6 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-900">Todas as Campanhas</h2>
            <p class="text-gray-600">Métricas de performance detalhadas</p>
          </div>
          <div class="p-6">
            <div id="campaignsTableContainer" class="table-container">
              <table id="campaignsTable">
                <thead>
                  <tr>
                    <th>Campanha</th>
                    <th>Período</th>
                    <th class="text-right">Investimento</th>
                    <th class="text-right">Retorno</th>
                    <th class="text-right">Lucro</th>
                    <th class="text-right">ROI</th>
                    <th class="text-right">CPC</th>
                  </tr>
                </thead>
                <tbody id="campaignsTableBody">
                  <tr>
                    <td colspan="7" class="text-center py-8 text-gray-500">
                      <i class="fas fa-chart-bar text-5xl mb-4 opacity-50"></i>
                      <p class="mt-2">Nenhuma campanha no sistema</p>
                      <p class="text-sm">Adicione campanhas usando o formulário para ver métricas detalhadas</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Estado da aplicação
    let campaigns = [];
    let currentPeriod = 'daily';
    let selectedCampaign = 'all';
    
    // Carregar campanhas do localStorage
    function loadCampaigns() {
      const savedCampaigns = localStorage.getItem('campaigns');
      if (savedCampaigns) {
        campaigns = JSON.parse(savedCampaigns);
        updateCampaignFilter();
        updateDashboard();
      }
    }
    
    // Salvar campanhas no localStorage
    function saveCampaigns() {
      localStorage.setItem('campaigns', JSON.stringify(campaigns));
    }
    
    // Atualizar filtro de campanhas
    function updateCampaignFilter() {
      const campaignFilter = document.getElementById('campaignFilter');
      campaignFilter.innerHTML = '<option value="all">Todas as Campanhas</option>';
      
      const uniqueCampaigns = [...new Set(campaigns.map(c => c.name))];
      uniqueCampaigns.forEach(campaign => {
        const option = document.createElement('option');
        option.value = campaign;
        option.textContent = campaign;
        campaignFilter.appendChild(option);
      });
      
      campaignFilter.value = selectedCampaign;
    }
    
    // Validar formulário
    function validateForm() {
      let isValid = true;
      const name = document.getElementById('campaignName').value.trim();
      const investment = parseFloat(document.getElementById('investment').value);
      const returnAmount = parseFloat(document.getElementById('return').value);
      const clicks = parseInt(document.getElementById('clicks').value);
      
      // Limpar erros anteriores
      document.querySelectorAll('.error').forEach(el => el.classList.add('hidden'));
      
      // Validar nome
      if (!name) {
        document.getElementById('nameError').textContent = 'Nome da campanha é obrigatório';
        document.getElementById('nameError').classList.remove('hidden');
        isValid = false;
      }
      
      // Validar investimento
      if (isNaN(investment) || investment <= 0) {
        document.getElementById('investmentError').textContent = 'Investimento deve ser um número positivo';
        document.getElementById('investmentError').classList.remove('hidden');
        isValid = false;
      }
      
      // Validar retorno
      if (isNaN(returnAmount) || returnAmount < 0) {
        document.getElementById('returnError').textContent = 'Retorno deve ser um número válido';
        document.getElementById('returnError').classList.remove('hidden');
        isValid = false;
      }
      
      // Validar cliques
      if (isNaN(clicks) || clicks <= 0) {
        document.getElementById('clicksError').textContent = 'Cliques deve ser um número positivo';
        document.getElementById('clicksError').classList.remove('hidden');
        isValid = false;
      }
      
      return isValid;
    }
    
    // Adicionar nova campanha
    function addCampaign() {
      if (!validateForm()) return;
      
      const name = document.getElementById('campaignName').value.trim();
      const investment = parseFloat(document.getElementById('investment').value);
      const returnAmount = parseFloat(document.getElementById('return').value);
      const clicks = parseInt(document.getElementById('clicks').value);
      const period = document.getElementById('period').value;
      
      // Calcular valores baseados no período
      let dailyInvestment, dailyReturn, dailyClicks;
      
      switch(period) {
        case 'daily':
          dailyInvestment = investment;
          dailyReturn = returnAmount;
          dailyClicks = clicks;
          break;
        case 'weekly':
          dailyInvestment = investment / 7;
          dailyReturn = returnAmount / 7;
          dailyClicks = clicks / 7;
          break;
        case 'monthly':
          dailyInvestment = investment / 30;
          dailyReturn = returnAmount / 30;
          dailyClicks = clicks / 30;
          break;
        case 'yearly':
          dailyInvestment = investment / 365;
          dailyReturn = returnAmount / 365;
          dailyClicks = clicks / 365;
          break;
      }
      
      const dailyProfit = dailyReturn - dailyInvestment;
      const roi = dailyInvestment > 0 ? (dailyProfit / dailyInvestment) * 100 : 0;
      const costPerClick = dailyClicks > 0 ? dailyInvestment / dailyClicks : 0;
      
      const campaign = {
        id: Date.now().toString(),
        name: name,
        period: period,
        investment: dailyInvestment,
        return: dailyReturn,
        clicks: dailyClicks,
        dailyProfit: dailyProfit,
        weeklyProfit: dailyProfit * 7,
        monthlyProfit: dailyProfit * 30,
        yearlyProfit: dailyProfit * 365,
        roi: roi,
        costPerClick: costPerClick
      };
      
      campaigns.push(campaign);
      saveCampaigns();
      updateCampaignFilter();
      updateDashboard();
      
      // Limpar formulário
      document.getElementById('campaignName').value = '';
      document.getElementById('investment').value = '';
      document.getElementById('return').value = '';
      document.getElementById('clicks').value = '';
      document.getElementById('period').value = 'daily';
    }
    
    // Formatar moeda
    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      }).format(value);
    }
    
    // Formatar porcentagem
    function formatPercentage(value) {
      return value.toFixed(2) + '%';
    }
    
    // Obter valor baseado no período atual
    function getValueByPeriod(campaign, valueType) {
      switch(currentPeriod) {
        case 'daily':
          return campaign[valueType];
        case 'weekly':
          return campaign[valueType] * 7;
        case 'monthly':
          return campaign[valueType] * 30;
        case 'yearly':
          return campaign[valueType] * 365;
        default:
          return campaign[valueType];
      }
    }
    
    // Atualizar dashboard
    function updateDashboard() {
      // Filtrar campanhas
      let filteredCampaigns = campaigns;
      if (selectedCampaign !== 'all') {
        filteredCampaigns = campaigns.filter(c => c.name === selectedCampaign);
      }
      
      // Atualizar métricas totais
      const totalInvestment = filteredCampaigns.reduce((sum, c) => sum + getValueByPeriod(c, 'investment'), 0);
      const totalReturn = filteredCampaigns.reduce((sum, c) => sum + getValueByPeriod(c, 'return'), 0);
      const totalProfit = filteredCampaigns.reduce((sum, c) => sum + getValueByPeriod(c, 'dailyProfit'), 0);
      const avgRoi = filteredCampaigns.length > 0 
        ? filteredCampaigns.reduce((sum, c) => sum + c.roi, 0) / filteredCampaigns.length 
        : 0;
      
      document.getElementById('totalInvestment').textContent = formatCurrency(totalInvestment);
      document.getElementById('totalReturn').textContent = formatCurrency(totalReturn);
      document.getElementById('totalProfit').textContent = formatCurrency(totalProfit);
      document.getElementById('avgRoi').textContent = formatPercentage(avgRoi);
      
      // Atualizar rankings
      const sortedCampaigns = [...filteredCampaigns].sort((a, b) => 
        getValueByPeriod(b, 'dailyProfit') - getValueByPeriod(a, 'dailyProfit')
      );
      const topCampaigns = sortedCampaigns.slice(0, 5);
      
      const rankingsContainer = document.getElementById('rankingsContainer');
      if (topCampaigns.length > 0) {
        let rankingsHTML = `
          <div class="table-container">
            <table class="w-full">
              <thead>
                <tr>
                  <th>Posição</th>
                  <th>Campanha</th>
                  <th class="text-right">Lucro</th>
                  <th class="text-right">ROI</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        topCampaigns.forEach((campaign, index) => {
          const profitValue = getValueByPeriod(campaign, 'dailyProfit');
          const profitClass = profitValue >= 0 ? 'profit-positive' : 'profit-negative';
          const roiClass = campaign.roi >= 0 ? 'profit-positive' : 'profit-negative';
          const rankClass = index === 0 ? 'rank-1' : 'rank-other';
          
          rankingsHTML += `
            <tr>
              <td>
                <span class="px-2 py-1 rounded-full text-xs font-bold ${rankClass}">
                  ${index + 1}
                </span>
              </td>
              <td class="font-medium">${campaign.name}</td>
              <td class="text-right ${profitClass} font-medium">
                ${formatCurrency(profitValue)}
              </td>
              <td class="text-right ${roiClass} font-medium">
                ${formatPercentage(campaign.roi)}
              </td>
            </tr>
          `;
        });
        
        rankingsHTML += `
              </tbody>
            </table>
          </div>
        `;
        
        rankingsContainer.innerHTML = rankingsHTML;
      } else {
        rankingsContainer.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <i class="fas fa-chart-line text-5xl mb-4 opacity-50"></i>
            <p class="mt-2">Nenhuma campanha adicionada ainda</p>
            <p class="text-sm">Adicione sua primeira campanha para ver os rankings</p>
          </div>
        `;
      }
      
      // Atualizar tabela de campanhas
      const campaignsTableBody = document.getElementById('campaignsTableBody');
      if (filteredCampaigns.length > 0) {
        let tableHTML = '';
        
        filteredCampaigns.forEach(campaign => {
          const investmentValue = getValueByPeriod(campaign, 'investment');
          const returnValue = getValueByPeriod(campaign, 'return');
          const profitValue = getValueByPeriod(campaign, 'dailyProfit');
          
          const profitClass = profitValue >= 0 ? 'profit-positive' : 'profit-negative';
          const roiClass = campaign.roi >= 0 ? 'profit-positive' : 'profit-negative';
          
          // Converter período para texto
          const periodText = {
            'daily': 'Diário',
            'weekly': 'Semanal',
            'monthly': 'Mensal',
            'yearly': 'Anual'
          }[campaign.period] || campaign.period;
          
          tableHTML += `
            <tr>
              <td class="font-medium">${campaign.name}</td>
              <td>${periodText}</td>
              <td class="text-right">${formatCurrency(investmentValue)}</td>
              <td class="text-right">${formatCurrency(returnValue)}</td>
              <td class="text-right ${profitClass} font-medium">
                ${formatCurrency(profitValue)}
              </td>
              <td class="text-right ${roiClass} font-medium">
                ${formatPercentage(campaign.roi)}
              </td>
              <td class="text-right">${formatCurrency(campaign.costPerClick)}</td>
            </tr>
          `;
        });
        
        campaignsTableBody.innerHTML = tableHTML;
      } else {
        campaignsTableBody.innerHTML = `
          <tr>
            <td colspan="7" class="text-center py-8 text-gray-500">
              <i class="fas fa-chart-bar text-5xl mb-4 opacity-50"></i>
              <p class="mt-2">Nenhuma campanha no sistema</p>
              <p class="text-sm">Adicione campanhas usando o formulário para ver métricas detalhadas</p>
            </td>
          </tr>
        `;
      }
    }
    
    // Inicializar aplicação
    document.addEventListener('DOMContentLoaded', function() {
      // Carregar campanhas salvas
      loadCampaigns();
      
      // Adicionar evento ao botão
      document.getElementById('addCampaignBtn').addEventListener('click', addCampaign);
      
      // Adicionar evento ao pressionar Enter no formulário
      document.querySelectorAll('input').forEach(input => {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            addCampaign();
          }
        });
      });
      
      // Adicionar eventos aos botões de período
      document.querySelectorAll('.period-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentPeriod = this.getAttribute('data-period');
          updateDashboard();
        });
      });
      
      // Adicionar evento ao filtro de campanha
      document.getElementById('campaignFilter').addEventListener('change', function() {
        selectedCampaign = this.value;
        updateDashboard();
      });
    });
  </script>
</body>
</html>